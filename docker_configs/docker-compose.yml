version: '3.8'
services:
  airflow:
    image: my_airflow_image:test_v1
    ports:
      - "8000:8080"
    command: >
      bash -c '
      airflow db init &&
      airflow users create \
        --username admin \
        --password admin \
        --firstname Admin \
        --lastname User \
        --role Admin \
        --email admin@example.com &&
      airflow webserver & airflow scheduler &&
      mkdir 1. make the directory for the dbt subfolders and create a subfolder for this project
      2. run dbt init in there
      3. delete the examples folder in models
      4. create one for airflow
      5. in news python file, replace the paths so match with the files created here
      '
    volumes:
      - airflow-db:/home/airflow/airflow
      - ./dags:/home/airflow/dags
    restart: on-failure

volumes:
  airflow-db: